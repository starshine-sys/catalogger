<!DOCTYPE html>
<html>

<head>
    <title>{{.Guild.Name}} - Catalogger</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <style>
        .dropdown-menu {
            max-height: 30em;
            overflow-y: auto;
        }

        .panel-form {
            background-color: #ccc;
            border: 1px solid #999;
            border-radius: 10px;
            padding: 10px 10px;
        }

        .channel-entry {
            padding: 0.5em 0;
        }
    </style>
</head>

<body>
    <nav class="navbar sticky-top navbar-dark bg-dark navbar-expand-md">
        <div class="container-fluid">
            <a href="/" class="navbar-brand">Catalogger</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a href="/" class="nav-link">Home</a>
                    </li>
                    <li class="nav-item">
                        <a href="https://github.com/starshine-sys/catalogger/blob/main/docs/USAGE.md"
                            class="nav-link">Documentation</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="serverListLink" role="button"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            Your servers
                        </a>
                        <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="serverListLink">
                            <li><a class="dropdown-item" href="/servers">Server list</a></li>
                            {{if .JoinedGuilds}}
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li>
                                <h6 class="dropdown-header">Servers you can manage</h6>
                            </li>
                            {{end}}
                            {{range .JoinedGuilds}}
                            <li><a class="dropdown-item {{if (eq .ID $.Guild.ID)}}active{{end}}"
                                    href="{{.Link}}">{{.Name}}</a></li>
                            {{end}}
                            {{if .UnjoinedGuilds}}
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li>
                                <h6 class="dropdown-header">Servers you can add Catalogger to</h6>
                            </li>
                            {{end}}
                            {{range .UnjoinedGuilds}}
                            <li><a class="dropdown-item" href="{{.Link}}">{{.Name}}</a></li>
                            {{end}}
                        </ul>
                    </li>
                </ul>
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="accountMenuLink" role="button"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            <img src="{{.User.AvatarURL}}" alt="Your avatar"
                                style="border-radius: 0.75em; height: 1.5em;">
                            {{.User.Username}}#{{.User.Discriminator}}
                        </a>
                        <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="accountMenuLink">
                            <li><a class="dropdown-item" href="/logout">Logout</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="row">
            <div class="col">
                <div class="panel-form">
                    <h3>Default log channels</h3>
                    <form action="/servers/{{.Guild.ID}}/save-channels" method="post">
                        <h5>Messages</h5>

                        <div class="channel-entry">
                            <div class="form-floating">
                                <select id="MESSAGE_UPDATE" class="form-select" aria-label="Edited messages">
                                    {{selectOptions .Guild.Channels $.CurrentChannels.MESSAGE_UPDATE}}
                                </select>
                                <label for="MESSAGE_UPDATE">Edited messages</label>
                            </div>
                        </div>

                        <div class="channel-entry">
                            <div class="form-floating">
                                <select id="MESSAGE_DELETE" class="form-select" aria-label="Deleted messages">
                                    {{selectOptions .Guild.Channels $.CurrentChannels.MESSAGE_DELETE}}
                                </select>
                                <label for="MESSAGE_DELETE">Deleted messages</label>
                            </div>
                        </div>

                        <div class="channel-entry">
                            <div class="form-floating">
                                <select id="MESSAGE_DELETE_BULK" aria-describedby="messageDeleteBulkHelp"
                                    class="form-select" aria-label="Bulk deleted messages">
                                    {{selectOptions .Guild.Channels $.CurrentChannels.MESSAGE_DELETE_BULK}}
                                </select>
                                <label for="MESSAGE_DELETE_BULK">Bulk deleted messages</label>
                            </div>
                            <div id="messageDeleteBulkHelp" class="form-text">
                                Logs messages that are bulk deleted, such as
                                with Carl-bot's <code>!purge</code> command.
                            </div>
                        </div>

                        <h5>Members</h5>

                        <div class="channel-entry">
                            <div class="form-floating">
                                <select id="GUILD_MEMBER_ADD" aria-describedby="memberAddHelp" class="form-select"
                                    aria-label="Members joining">
                                    {{selectOptions .Guild.Channels $.CurrentChannels.GUILD_MEMBER_ADD}}
                                </select>
                                <label for="GUILD_MEMBER_ADD">Members joining</label>
                            </div>
                            <div id="memberAddHelp" class="form-text">
                                Logs new members joining the server, along with their
                                PluralKit system if they have one.
                            </div>
                        </div>


                        <div class="channel-entry">
                            <div class="form-floating">
                                <select id="GUILD_MEMBER_REMOVE" class="form-select" aria-label="Members leaving">
                                    {{selectOptions .Guild.Channels $.CurrentChannels.GUILD_MEMBER_REMOVE}}
                                </select>
                                <label for="GUILD_MEMBER_REMOVE">Members leaving</label>
                            </div>
                        </div>

                        <div class="channel-entry">
                            <div class="form-floating">
                                <select id="GUILD_BAN_ADD" class="form-select" aria-label="Bans" describedby="banHelp">
                                    {{selectOptions .Guild.Channels $.CurrentChannels.GUILD_BAN_ADD}}
                                </select>
                                <label for="GUILD_BAN_ADD">Bans</label>
                            </div>
                            <div id="banHelp" class="form-text">
                                Logs users being banned, along with their PluralKit system
                                if they have one. If a banned PluralKit system joins the server, a warning will be
                                attached to the message.
                            </div>
                        </div>

                        <div class="channel-entry">
                            <div class="form-floating">
                                <select id="GUILD_BAN_REMOVE" class="form-select" aria-label="Unbans">
                                    {{selectOptions .Guild.Channels $.CurrentChannels.GUILD_BAN_REMOVE}}
                                </select>
                                <label for="GUILD_BAN_REMOVE">Unbans</label>
                            </div>
                        </div>

                        <div class="channel-entry">
                            <div class="form-floating">
                                <select id="GUILD_MEMBER_UPDATE" class="form-select" aria-label="Member role changes">
                                    {{selectOptions .Guild.Channels $.CurrentChannels.GUILD_MEMBER_UPDATE}}
                                </select>
                                <label for="GUILD_MEMBER_UPDATE">Member role changes</label>
                            </div>
                        </div>

                        <div class="channel-entry">
                            <div class="form-floating">
                                <select id="GUILD_MEMBER_NICK_UPDATE" class="form-select"
                                    aria-label="Member name/avatar changes">
                                    {{selectOptions .Guild.Channels $.CurrentChannels.GUILD_MEMBER_NICK_UPDATE}}
                                </select>
                                <label for="GUILD_MEMBER_NICK_UPDATE">Member name/avatar changes</label>
                            </div>
                        </div>

                        <h5>Server changes</h5>

                        <div class="channel-entry">
                            <div class="form-floating">
                                <select id="INVITE_CREATE" class="form-select" aria-label="Created invites">
                                    {{selectOptions .Guild.Channels $.CurrentChannels.INVITE_CREATE}}
                                </select>
                                <label for="INVITE_CREATE">Created invites</label>
                            </div>
                        </div>

                        <div class="channel-entry">
                            <div class="form-floating">
                                <select id="INVITE_DELETE" class="form-select" aria-label="Deleted invites">
                                    {{selectOptions .Guild.Channels $.CurrentChannels.INVITE_DELETE}}
                                </select>
                                <label for="INVITE_DELETE">Deleted invites</label>
                            </div>
                        </div>

                        <div class="channel-entry">
                            <div class="form-floating">
                                <select id="CHANNEL_CREATE" class="form-select" aria-label="Created channels">
                                    {{selectOptions .Guild.Channels $.CurrentChannels.CHANNEL_CREATE}}
                                </select>
                                <label for="CHANNEL_CREATE">Created channels</label>
                            </div>
                        </div>

                        <div class="channel-entry">
                            <div class="form-floating">
                                <select id="CHANNEL_UPDATE" class="form-select" aria-label="Edited channels">
                                    {{selectOptions .Guild.Channels $.CurrentChannels.CHANNEL_UPDATE}}
                                </select>
                                <label for="CHANNEL_UPDATE">Edited channels</label>
                            </div>
                        </div>

                        <div class="channel-entry">
                            <div class="form-floating">
                                <select id="CHANNEL_DELETE" class="form-select" aria-label="Deleted channels">
                                    {{selectOptions .Guild.Channels $.CurrentChannels.CHANNEL_DELETE}}
                                </select>
                                <label for="CHANNEL_DELETE">Deleted channels</label>
                            </div>
                        </div>

                        <div class="channel-entry">
                            <div class="form-floating">
                                <select id="GUILD_ROLE_CREATE" class="form-select" aria-label="Created roles">
                                    {{selectOptions .Guild.Channels $.CurrentChannels.GUILD_ROLE_CREATE}}
                                </select>
                                <label for="GUILD_ROLE_CREATE">Created roles</label>
                            </div>
                        </div>

                        <div class="channel-entry">
                            <div class="form-floating">
                                <select id="GUILD_ROLE_UPDATE" class="form-select" aria-label="Edited roles">
                                    {{selectOptions .Guild.Channels $.CurrentChannels.GUILD_ROLE_UPDATE}}
                                </select>
                                <label for="GUILD_ROLE_UPDATE">Edited roles</label>
                            </div>
                        </div>

                        <div class="channel-entry">
                            <div class="form-floating">
                                <select id="GUILD_ROLE_DELETE" class="form-select" aria-label="Deleted roles">
                                    {{selectOptions .Guild.Channels $.CurrentChannels.GUILD_ROLE_DELETE}}
                                </select>
                                <label for="GUILD_ROLE_DELETE">Deleted roles</label>
                            </div>
                        </div>

                        <div class="channel-entry">
                            <div class="form-floating">
                                <select id="GUILD_UPDATE" class="form-select" aria-label="Server updates">
                                    {{selectOptions .Guild.Channels $.CurrentChannels.GUILD_UPDATE}}
                                </select>
                                <label for="GUILD_UPDATE">Server updates</label>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-success">Save</button>
                    </form>
                </div>
            </div>
            <div class="col">
                <div class="panel-form">
                    <h3>Ignored channels</h3>
                    <p>
                        Channels selected here will not have any messages logged.
                        This only applies to the <strong>Edited messages</strong>, <strong>Deleted messages</strong>,
                        and <strong>Bulk deleted messages</strong> logs.
                    </p>
                    <form action="/servers/{{.Guild.ID}}/save-ignored" method="post">
                        <div class="channel-entry">
                            <select id="ignored-channels" multiple class="form-select" aria-label="Ignored channels"
                                size="10">
                                {{multiselectOptions .Guild.Channels $.IgnoredChannels}}
                            </select>
                        </div>

                        <button type="submit" class="btn btn-success">Save</button>
                    </form>
                </div>

                <div class="panel-form">
                    <h3>Redirected channels</h3>
                    <form action="/servers/{{.Guild.ID}}/add-redirect" method="post">
                        <h5>Add a redirect</h5>
                        <div class="row">
                            <div class="col">
                                <div class="form-floating">
                                    <select id="from-channel" class="form-select" aria-label="From channel">
                                        {{selectOptionsIgnoreMultiple .Guild.Channels $.RedirectedChannels}}
                                    </select>
                                    <label for="from-channel">From</label>
                                </div>
                            </div>
                            <div class="col">
                                <div class="form-floating">
                                    <select id="to-channel" class="form-select" aria-label="To channel">
                                        {{selectOptions .Guild.Channels 0}}
                                    </select>
                                    <label for="to-channel">To</label>
                                </div>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-success">Add redirect</button>
                    </form>
                    {{if .Redirects}}
                    <div class="redirects">
                        <h5>Currently redirected channels</h5>
                        <ul>
                            {{range .Redirects}}
                            <li>#{{.From.Name}} logging to #{{.To.Name}} <a href="/servers/{{$.Guild.ID}}/delete-redirect/{{.From.ID}}">(delete)</a></li>
                            {{end}}
                        </ul>
                    </div>
                    {{end}}
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
</body>

</html>